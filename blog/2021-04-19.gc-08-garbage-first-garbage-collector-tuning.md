[Garbage Collection Tuning](https://docs.oracle.com/en/java/javase/16/gctuning/introduction-garbage-collection-tuning.html)
===
[fdj32.github.io](https://fdj32.github.io)  
# 8. [垃圾优先垃圾收集器调优](https://docs.oracle.com/en/java/javase/16/gctuning/garbage-first-garbage-collector-tuning.html)
本节描述如何在垃圾优先垃圾收集器（G1 GC）行为不满足您的需求时对其进行调整。

话题：
- <a href="#gc8a">G1的一般建议</a>
- <a href="#gc8b">从其他收集器迁移到G1</a>
- <a href="#gc8c">提高G1性能</a>
  - <a href="#gc8c1">观察完全垃圾收集</a>
  - <a href="#gc8c2">巨大对象碎片</a>
  - <a href="#gc8c3">调整延迟</a>
    - <a href="#gc8c3a">异常系统或实时使用</a>
    - <a href="#gc8c3b">引用对象处理时间过长</a>
    - <a href="#gc8c3c">仅年轻阶段中仅年轻的收集花费的时间太长</a>
    - <a href="#gc8c3d">混合收集花费时间太长</a>
    - <a href="#gc8c3e">高更新记忆集和扫描记忆集次数</a>
  - <a href="#gc8c4">吞吐量调整</a>
  - <a href="#gc8c5">调整堆大小</a>
  - <a href="#gc8c6">可调默认值</a>

## <span id="gc8a">G1的一般建议</span>
一般建议使用G1及其默认设置，最终给它一个不同的暂停时间目标，并根据需要使用-Xmx设置最大Java堆大小。

G1默认值的平衡方式与其他收集器不同。G1在默认配置中的目标既不是最大吞吐量，也不是最低延迟，而是在高吞吐量下提供相对较小的、均匀的暂停。但是，G1增量回收堆中空间的机制和暂停时间控制在应用程序线程和空间回收效率方面都会产生一些开销。

如果您喜欢高吞吐量，那么可以使用-XX:MaxGCPauseMillis 来放宽暂停时间目标，或者提供更大的堆。如果延迟是主要需求，那么修改暂停时间目标。避免使用-Xmn、-XX:NewRatio等选项将年轻代大小限制为特定值，因为年轻代大小是G1满足暂停时间的主要手段。将年轻代大小设置为单个值将覆盖并实际上禁用暂停时间控制。
## <span id="gc8b">从其他收集器迁移到G1</span>
通常，当从其他收集器（特别是并发标记扫描收集器）迁移到G1时，首先删除所有影响垃圾收集的选项，然后只设置暂停时间目标和使用-Xmx和可选的-Xms设置总堆大小。

许多对其他收集器以某种特定方式响应有用的选项要么根本没有效果，要么甚至降低吞吐量和满足暂停时间目标的可能性。例如，设置年轻代的大小可以完全阻止G1调整年轻代的大小以满足暂停时间目标。
## <span id="gc8c">提高G1性能</span>
G1的设计目的是提供良好的整体性能，而无需指定其他选项。但是，在某些情况下，默认的启发式算法或默认的配置提供了次优的结果。本节给出了一些诊断和改善这些病例的指南。本指南仅描述在给定一个set应用程序时，G1在所选度量中提高垃圾收集器性能的可能性。在个案的基础上，应用程序级优化可能比试图调优VM以获得更好的性能更有效，例如，通过使用寿命更短的对象来避免一些有问题的情况。

出于诊断目的，G1提供了全面的日志记录。一个好的开始就是使用-Xlog:gc*=debug选项，然后根据该选项优化输出（如果需要）。日志提供了暂停期间和暂停之外有关垃圾收集活动的详细概述。这包括收集的类型和在暂停的特定阶段花费的时间的细分。

以下小节将探讨一些常见的性能问题。
### <span id="gc8c1">观察完全垃圾收集</span>
### <span id="gc8c2">巨大对象碎片</span>
### <span id="gc8c3">调整延迟</span>
#### <span id="gc8c3a">异常系统或实时使用</span>
#### <span id="gc8c3b">引用对象处理时间过长</span>
#### <span id="gc8c3c">仅年轻阶段中仅年轻的收集花费的时间太长</span>
#### <span id="gc8c3d">混合收集花费时间太长</span>
#### <span id="gc8c3e">高更新记忆集和扫描记忆集次数</span>
### <span id="gc8c4">吞吐量调整</span>
### <span id="gc8c5">调整堆大小</span>
### <span id="gc8c6">可调默认值</span>
