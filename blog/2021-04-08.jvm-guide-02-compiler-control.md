[Java.Virtural.Machine.Guide](https://docs.oracle.com/en/java/javase/16/vm/java-virtual-machine-technology-overview.html)
===
[fdj32.github.io](https://fdj32.github.io)  
# 2. [编译器控制](https://docs.oracle.com/en/java/javase/16/vm/compiler-control1.html)

编译器控制通过编译指令选项提供一个方法去控制JVM编译，控制级别是运行时可管理和针对特定方法的。

一项编译器指令是告诉JVM编译如何进行的指令。它在编译过程中提供方法上下文精度。你可以使用指令去编写小型的，嵌入的，JVM编译器测试，可以在无需重启整个JVM的情况下运行。你也可以使用指令为bug在JVM编译器中创建变通方法。

当你通过控制台命令行启动一个程序的时候，你可以指定一个文件包含编译器指令。你也可以通过诊断命令在一个已经运行的程序中，添加或者删除指令。

编译器控制取代且兼容编译命令。

## 2.1. 编写指令
### a. 编译器控制选项
编译器控制选项是编译指令。选项提供方法上下文精度。选项随不同的编译器而不同，且要求特定类型的值。

表 2-1 通用选项

| 选项 | 描述 | 值类型 | 默认值 |
| --- | --- | --- | --- |
| Enable | false: 隐藏一条指令且把它渲染成不匹配。它在避免选项重复的时候有用。参考 <a href="#aaf">使用Enable选项避免重复</a> | bool | true |
| Exclude | 编译时排除方法 | bool | false |
| BreakAtExecute | 当debug JVM的时候，设置一个断点，在特定方法开始处停止执行。 | bool | false |
| BreakAtCompile | 当debug JVM的时候，设置一个断点，在特定方法开始处停止编译。 | bool | false |
| Log | 在日志里放置特定一些方法。你必须首先设置命令行选项 -XX:+LogCompilation。默认值false表示放置所有编译的方法到日志里。 | bool | false |
| PrintAssembly | 使用外部的库disassembler.so为字节编码的和内联的方法打印装配代码 | bool | false |
| PrintInlining | 打印哪些方法在哪里是内联的 | bool | false |
| PrintNMethods | 打印生成的方法序号 | bool | false |
| BackgroundCompilation | 以后台任务方法编译方法。方法以解释器模式执行直到这个后台编译结束。false表示以前台任务方式编译方法。 | bool | true |
| ReplayInline | 与相应的全局选项对应，但是基于单个方法，开启相同的CIReplay功能。 | bool | false |
| DumpReplay | 与相应的全局选项对应，但是基于单个方法，开启相同的CIReplay功能。 | bool | false |
| CompilerDirectivesIgnoreCompileCommands | 忽略无视所有编译命令 | bool | false |
| DisableIntrinsic | 基于方法匹配条件关闭内在函数的使用 | ccstr | 无 |
| inline | 基于方法匹配条件，强制或避免将方法转为内联，参考 <a href="#aae">编写一条内联指令选项</a> | ccstr[] | 无 |

表 2-2 C2 排除选项

| 选项 | 描述 | 值类型 | 默认值 |
| --- | --- | --- | --- |
| BlockLayoutByFrequency | 从热点路径中移除不经常执行到的分支 | bool | true |
| PrintOptoAssembly | 通过使用外部库disassembler.so在编译之后打印生成的装配代码。这需要JVM的一个调试构建 | bool | false |
| PrintIntrinsics | 打印哪些内在函数在哪里使用 | bool | false |
| TraceOptoPipelining | 跟踪流水线信息，与相应全局选项相似，但是基于单个方法，这个选项偏向于慢的和快速调试构建。 | bool | false |
| TraceOptoOutput | 跟踪流水线信息，与相应全局选项相似，但是基于单个方法，这个选项偏向于慢的和快速调试构建。 | bool | false |
| TraceSpilling | 跟踪变量溢出 | bool | false |
| Vectorize | 使用并行计算，跨向量寄存器 | intx | 0 |
| CloneMapDebug | 使你能够检查矢量化生成的CloneMap。这需要一个JVM调试构建。 | bool | false |
| IGVPrintLevel | 在理想图形可视化工具中设定编译器图形打印的位置，值越大，粒度越高。 | intx | 0 |
| MaxNodeLimit | 在单个方法的编译时，设置使用节点的最大个数 | intx | 80000 |

一个 ccstr 值类型是一个方法模式。参考 <a href="#aad">用一条编译器指令编写一个方法模式</a>。
默认指令提供编译器选项默认值。参考<a href="">什么是默认指令</a>

### b. 编写一个指令文件

### c. 编写一条编译器指令

### d. <span id="aad">用一条编译器指令编写一个方法模式</span>

### e. <span id="aae">编写一条内联指令选项</span>

### f. <span id="aaf">使用Enable选项避免重复</span>